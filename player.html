<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ShadowPlayer - Movie/TV Player</title>
    <style>
      body {
        background: #0f0f0f;
        color: white;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }

      .header {
        background: #1a1a2e;
        padding: 20px;
        text-align: center;
      }

      .tabs {
        display: flex;
        justify-content: center;
        margin-top: 20px;
      }

      .tab {
        padding: 10px 20px;
        margin: 0 10px;
        cursor: pointer;
        border: 1px solid #444;
        border-radius: 5px;
        background: #222;
      }

      .tab.active {
        background: #ff6347;
      }

      .search-container {
        text-align: center;
        margin-top: 20px;
      }

      .search-input {
        padding: 10px;
        font-size: 1rem;
        border-radius: 5px;
      }

      .search-button {
        padding: 10px 15px;
        margin-left: 10px;
        background-color: #ff6347;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      .about-section {
        background: #222;
        padding: 30px;
        margin-top: 20px;
        text-align: center;
      }

      .about-section h2 {
        color: #ff6347;
      }

      .about-section p {
        max-width: 800px;
        margin: 0 auto;
        font-size: 1rem;
      }

      .content-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        justify-items: center;
        margin-top: 30px;
      }

      .content-card {
        background: #333;
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        cursor: pointer;
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease;
      }

      .content-card:hover {
        transform: scale(1.05);
      }

      .content-card img {
        width: 100%;
        border-radius: 10px;
      }

      .content-card h3 {
        margin-top: 10px;
      }

      .player {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        z-index: 1000;
        background-color: rgba(0, 0, 0, 0.8);
        padding: 20px;
        border-radius: 10px;
        width: 80%;
        max-width: 900px;
      }

      .player iframe {
        width: 100%;
        height: 500px;
        border: none;
      }

      .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 999;
      }

      .section-title {
        text-align: center;
        font-size: 1.5rem;
        margin-top: 50px;
        color: #ff6347;
      }
    </style>
  </head>
  <body>

    <!-- Header -->
    <div class="header">
      <h1>Welcome to ShadowPlayer</h1>
      <p>Stream your favorite content!</p>
    </div>

    <!-- Content Search -->
    <div class="search-container">
      <input id="search-input" class="search-input" type="text" placeholder="Search Movies/TV Shows" />
      <button class="search-button" onclick="searchContent()">Search</button>
    </div>

    <!-- Tabs for Movies and TV Shows -->
    <div class="tabs">
      <div id="movie-tab" class="tab active" onclick="toggleTab('movie')">Movies</div>
      <div id="tv-show-tab" class="tab" onclick="toggleTab('tv-show')">TV Shows</div>
    </div>

    <!-- About Section (Right Below the Buttons) -->
    <div class="about-section">
      <h2>About ShadowPlayer</h2>
      <p>ShadowPlayer is your go-to platform for streaming the latest movies and TV shows. With an easy-to-use interface and a wide selection of content, ShadowPlayer lets you enjoy your favorite media with ease and convenience.</p>
    </div>

    <!-- Trending Content -->
    <div class="section-title">Trending Content</div>
    <div class="content-container" id="popular-container"></div>

    <!-- Content Player -->
    <div id="player" class="player">
      <h2>Now Playing</h2>
      <iframe id="player-frame" src="" frameborder="0" allowfullscreen></iframe>
    </div>

    <!-- Overlay for background dimming -->
    <div id="overlay" class="overlay" onclick="closePlayer()"></div>

    <script>
      const loggedIn = localStorage.getItem("userLoggedIn");
      const username = localStorage.getItem("username");

      if (!loggedIn || (username !== "beta-test" && !loggedIn)) {
        window.location.href = "index.html"; 
      }

      const API_KEY = "c712408a293423784df0be76dc14af13";
      const TMDB_API = "https://api.themoviedb.org/3";
      let currentTab = 'movie'; 

      function toggleTab(tab) {
        currentTab = tab;
        const movieTab = document.getElementById('movie-tab');
        const tvShowTab = document.getElementById('tv-show-tab');
        
        if (tab === 'movie') {
          movieTab.classList.add('active');
          tvShowTab.classList.remove('active');
        } else {
          tvShowTab.classList.add('active');
          movieTab.classList.remove('active');
        }
        searchContent(); 
      }

      async function searchContent() {
        const query = document.getElementById("search-input").value;
        if (!query) return;

        try {
          let url = '';
          if (currentTab === 'movie') {
            url = `${TMDB_API}/search/movie?api_key=${API_KEY}&query=${query}`;
          } else if (currentTab === 'tv-show') {
            url = `${TMDB_API}/search/tv?api_key=${API_KEY}&query=${query}`;
          }

          const response = await fetch(url);
          const data = await response.json();
          displayResults(data.results);
        } catch (error) {
          console.error("Error fetching data: ", error);
        }
      }

      function displayResults(results) {
        const container = document.getElementById("popular-container");
        container.innerHTML = ""; 

        results.forEach((item) => {
          const card = document.createElement("div");
          card.className = "content-card";
          card.innerHTML = `
            <img src="https://image.tmdb.org/t/p/w500${item.poster_path}" alt="${item.title}">
            <h3>${item.title}</h3>
          `;
          card.onclick = () => playContent(item.id);
          container.appendChild(card);
        });
      }

      async function displayPopularAndRecent() {
        try {
          const popularResponse = await fetch(`${TMDB_API}/movie/popular?api_key=${API_KEY}`);
          const recentResponse = await fetch(`${TMDB_API}/movie/latest?api_key=${API_KEY}`);

          const popularData = await popularResponse.json();
          const recentData = await recentResponse.json();

          displaySectionResults("popular-container", popularData.results);
        } catch (error) {
          console.error("Error fetching trending content: ", error);
        }
      }

      function displaySectionResults(sectionId, results) {
        const sectionContainer = document.getElementById(sectionId);
        sectionContainer.innerHTML = ""; 

        results.forEach((item) => {
          const card = document.createElement("div");
          card.className = "content-card";
          card.innerHTML = `
            <img src="https://image.tmdb.org/t/p/w500${item.poster_path}" alt="${item.title}">
            <h3>${item.title}</h3>
          `;
          card.onclick = () => playContent(item.id);
          sectionContainer.appendChild(card);
        });
      }

      function playContent(id) {
        const player = document.getElementById("player");
        const iframe = document.getElementById("player-frame");
        const overlay = document.getElementById("overlay");

        // Using 2Embed API to generate the video URL
        const videoUrl = `https://www.2embed.cc/embed/${id}?autoplay=1`;

        iframe.src = videoUrl;
        player.style.display = "block";
        overlay.style.display = "block";
      }

      function closePlayer() {
        const player = document.getElementById("player");
        const iframe = document.getElementById("player-frame");
        const overlay = document.getElementById("overlay");

        iframe.src = "";
        player.style.display = "none";
        overlay.style.display = "none";
      }

      displayPopularAndRecent();
    </script>
  </body>
</html>
